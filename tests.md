ФАЙЛ ОПИСАНИЯ ТЕСТОВ

ОБЩАЯ ИНФОРМАЦИЯ
Все тесты выполняются автоматически при запуске docker-compose up --build.
Тесты запускаются в следующем порядке:
1. AuthenticationUnitTest - тесты аутентификации
2. AuthenticationValidationTest - тесты валидации полей
3. JwtTokenTest - тесты JWT токенов

После успешного прохождения всех тестов запускается основное приложение.

================================================================================

ТЕСТЫ АУТЕНТИФИКАЦИИ (AuthenticationUnitTest)

Тест 1: Успешная регистрация пользователя
Входные данные:
- username: testuser_[timestamp] (уникальное имя пользователя)
- password: TestPassword123!
- email: test@example.com
- fullName: Test User
- gender: M
- phone: +1234567890
- description: Test user description

Отправляем: POST запрос на /api/auth/signup с JSON телом, содержащим все поля регистрации

Ожидаем: HTTP статус 200 OK с сообщением "Пользователь успешно зарегистрирован!"

Зачем нужен: Проверяем, что система корректно создает новых пользователей и возвращает успешный ответ при валидных данных.

================================================================================

Тест 2: Неуспешная регистрация - дублирование username
Входные данные:
- username: testuser_[timestamp] (тот же username, что использовался в тесте 1)
- password: TestPassword123!
- email: test@example.com
- fullName: Test User
- gender: M
- phone: +1234567890
- description: Test user description

Отправляем: POST запрос на /api/auth/signup с JSON телом, содержащим существующий username

Ожидаем: HTTP статус 4xx (ошибка клиента) - система должна отклонить регистрацию из-за дублирования username

Зачем нужен: Проверяем, что система корректно обрабатывает попытки создания пользователей с уже существующими именами.

================================================================================

Тест 3: Успешная авторизация и получение токена
Входные данные:
- username: testuser_[timestamp] (пользователь, созданный в тесте 1)
- password: TestPassword123!

Отправляем: POST запрос на /api/auth/signin с JSON телом, содержащим username и password

Ожидаем: HTTP статус 200 OK с JSON ответом, содержащим:
- token: JWT токен (строка длиной более 50 символов)
- type: "Bearer"
- username: имя пользователя
- email: email пользователя

Зачем нужен: Проверяем, что система корректно аутентифицирует пользователей и возвращает валидный JWT токен.

================================================================================

Тест 4: Неуспешная авторизация с неправильным паролем
Входные данные:
- username: testuser_[timestamp] (существующий пользователь)
- password: WrongPassword123! (неправильный пароль)

Отправляем: POST запрос на /api/auth/signin с JSON телом, содержащим правильный username, но неправильный пароль

Ожидаем: HTTP статус 401 Unauthorized - система должна отклонить авторизацию из-за неправильного пароля

Зачем нужен: Проверяем, что система корректно отклоняет попытки входа с неправильными учетными данными.

================================================================================

Тест 5: Неуспешная авторизация с несуществующим пользователем
Входные данные:
- username: nonexistentuser (несуществующий пользователь)
- password: SomePassword123!

Отправляем: POST запрос на /api/auth/signin с JSON телом, содержащим несуществующий username

Ожидаем: HTTP статус 401 Unauthorized - система должна отклонить авторизацию из-за несуществующего пользователя

Зачем нужен: Проверяем, что система корректно обрабатывает попытки входа с несуществующими пользователями.

================================================================================

ТЕСТЫ ВАЛИДАЦИИ (AuthenticationValidationTest)

Тест 1: Регистрация с пустым username
Входные данные:
- username: "" (пустая строка)
- password: TestPassword123!
- email: test@example.com
- fullName: Test User
- gender: M
- phone: +1234567890
- description: Test user description

Отправляем: POST запрос на /api/auth/signup с JSON телом, содержащим пустой username

Ожидаем: HTTP статус 4xx (ошибка клиента) - система должна отклонить регистрацию из-за пустого username

Зачем нужен: Проверяем, что система корректно валидирует обязательные поля и отклоняет запросы с пустыми значениями.

================================================================================

Тест 2: Регистрация с некорректным email
Входные данные:
- username: testuser_[timestamp]
- password: TestPassword123!
- email: invalid-email (некорректный формат email)
- fullName: Test User
- gender: M
- phone: +1234567890
- description: Test user description

Отправляем: POST запрос на /api/auth/signup с JSON телом, содержащим некорректный email

Ожидаем: HTTP статус 4xx (ошибка клиента) - система должна отклонить регистрацию из-за некорректного email

Зачем нужен: Проверяем, что система корректно валидирует формат email адресов.

================================================================================

Тест 3: Регистрация со слабым паролем
Входные данные:
- username: testuser_[timestamp]
- password: 123 (слабый пароль)
- email: test@example.com
- fullName: Test User
- gender: M
- phone: +1234567890
- description: Test user description

Отправляем: POST запрос на /api/auth/signup с JSON телом, содержащим слабый пароль

Ожидаем: HTTP статус 4xx (ошибка клиента) - система должна отклонить регистрацию из-за слабого пароля

Зачем нужен: Проверяем, что система корректно валидирует сложность паролей и требует достаточно сильные пароли.

================================================================================

Тест 4: Регистрация с пустым fullName
Входные данные:
- username: testuser_[timestamp]
- password: TestPassword123!
- email: test@example.com
- fullName: "" (пустая строка)
- gender: M
- phone: +1234567890
- description: Test user description

Отправляем: POST запрос на /api/auth/signup с JSON телом, содержащим пустое fullName

Ожидаем: HTTP статус 4xx (ошибка клиента) - система должна отклонить регистрацию из-за пустого fullName

Зачем нужен: Проверяем, что система корректно валидирует обязательные поля профиля пользователя.

================================================================================

Тест 5: Регистрация с null gender
Входные данные:
- username: testuser_[timestamp]
- password: TestPassword123!
- email: test@example.com
- fullName: Test User
- gender: null (отсутствующее значение)
- phone: +1234567890
- description: Test user description

Отправляем: POST запрос на /api/auth/signup с JSON телом, содержащим null gender

Ожидаем: HTTP статус 4xx (ошибка клиента) - система должна отклонить регистрацию из-за отсутствующего gender

Зачем нужен: Проверяем, что система корректно валидирует обязательные поля и отклоняет запросы с отсутствующими значениями.

================================================================================

ТЕСТЫ JWT ТОКЕНОВ (JwtTokenTest)

Тест 1: Создание пользователя для тестирования JWT
Входные данные:
- username: jwtuser_[timestamp] (уникальное имя пользователя)
- password: JwtPassword123!
- email: jwt@example.com
- fullName: JWT Test User
- gender: M
- phone: +1234567890
- description: JWT test user description

Отправляем: POST запрос на /api/auth/signup с JSON телом, содержащим все поля регистрации

Ожидаем: HTTP статус 200 OK с сообщением "Пользователь успешно зарегистрирован!"

Зачем нужен: Создаем тестового пользователя для последующих тестов JWT токенов.

================================================================================

Тест 2: Получение JWT токена
Входные данные:
- username: jwtuser_[timestamp] (пользователь, созданный в тесте 1)
- password: JwtPassword123!

Отправляем: POST запрос на /api/auth/signin с JSON телом, содержащим username и password

Ожидаем: HTTP статус 200 OK с JSON ответом, содержащим:
- token: JWT токен (строка длиной более 50 символов)
- type: "Bearer"
- username: имя пользователя
- email: email пользователя

Зачем нужен: Получаем JWT токен для последующих тестов его структуры и валидности.

================================================================================

Тест 3: Проверка валидности JWT токена
Входные данные: JWT токен, полученный в тесте 2

Проверяем:
- Токен не пустой (не null)
- Длина токена больше 50 символов
- Токен содержит 3 части, разделенные точками (стандартная структура JWT)

Ожидаем: Все проверки должны пройти успешно

Зачем нужен: Проверяем, что система генерирует JWT токены правильной структуры и достаточной длины.

================================================================================

Тест 4: Проверка содержимого JWT токена
Входные данные: JWT токен, полученный в тесте 2

Проверяем:
- Токен содержит точки (разделители частей JWT)
- Длина токена больше 100 символов (достаточная длина для безопасного токена)

Ожидаем: Все проверки должны пройти успешно

Зачем нужен: Проверяем, что система генерирует JWT токены достаточной сложности и длины для обеспечения безопасности.

================================================================================

ОЧИСТКА ТЕСТОВЫХ ДАННЫХ

После выполнения всех тестов система автоматически удаляет созданных тестовых пользователей:
- testuser_[timestamp] (из AuthenticationUnitTest)
- jwtuser_[timestamp] (из JwtTokenTest)

Это обеспечивает чистоту базы данных и предотвращает накопление тестовых данных.

================================================================================

ЛОГИРОВАНИЕ

Все тесты включают подробное логирование на каждом этапе:
- Начало каждого теста
- Отправляемые данные
- Полученные результаты
- Успешное завершение или ошибки
- Очистка тестовых данных

Логи помогают отслеживать выполнение тестов и диагностировать возможные проблемы.

================================================================================

НАСТРОЙКИ ТЕСТОВ

Тесты выполняются в тестовом профиле Spring с использованием H2 in-memory базы данных.
SQL запросы скрыты в логах для улучшения читаемости.
Все тесты выполняются в транзакциях с откатом изменений после завершения.

Это обеспечивает изоляцию тестов и предотвращает влияние тестовых данных на основное приложение.
